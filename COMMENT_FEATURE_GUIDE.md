# ฟีเจอร์คอมเมนต์สำหรับโหมดสัตว์หาย 🐕💬

## 🎯 ภาพรวมฟีเจอร์

ระบบคอมเมนต์แบบ Bottom Sheet ที่ออกแบบมาเพื่อช่วยเหลือในการหาสัตว์เลี้ยงที่หายไป โดยเฉพาะการสื่อสารระหว่างผู้ที่โพสต์และผู้ที่พบเจอสัตว์

### ✨ จุดเด่น
- **💬 Bottom Sheet คล้าย YouTube**: UI ที่คุ้นเคยและใช้งานง่าย
- **🔒 ป้องกันสแปม**: จำกัดคอมเมนต์ 5 ครั้ง/วัน/คน
- **🚫 ฟิลเตอร์คำหยาบ**: กรองคำไม่เหมาะสมอัตโนมัติ
- **🚨 รายงานคอมเมนต์**: ผู้ใช้สามารถรายงานความคิดเห็นที่ไม่เหมาะสม
- **⏰ TTL**: คอมเมนต์หมดอายุตามโพสต์ (7 วัน)

## 🏗️ สถาปัตยกรรมระบบ

### Firestore Structure
```
reports/
├── {reportId}/
│   ├── comments/
│   │   └── {commentId}
│   │       ├── comment: "เมื่อไหร่เจอครับ?"
│   │       ├── userId: "anonymous"
│   │       ├── timestamp: Timestamp
│   │       ├── expireAt: Timestamp (TTL)
│   │       ├── reported: false
│   │       └── reportCount: 0
```

### ไฟล์ที่เกี่ยวข้อง
1. **`lib/services/comment_service.dart`** - Logic การจัดการคอมเมนต์
2. **`lib/widgets/comment_bottom_sheet.dart`** - UI Bottom Sheet
3. **`lib/screens/list_screen.dart`** - ปุ่มเปิด comment (เฉพาะสัตว์หาย)

## 📱 การใช้งาน

### สำหรับผู้ใช้
1. **เห็นปุ่ม "แสดงความคิดเห็น"** ใต้โพสต์สัตว์หาย
2. **กดเปิด Bottom Sheet** พร้อมรายการคอมเมนต์
3. **พิมพ์คอมเมนต์** (สูงสุด 200 ตัวอักษร)
4. **รายงานคอมเมนต์** ที่ไม่เหมาะสม

### สำหรับ Admin
- ระบบกรองคำหยาบอัตโนมัติ
- TTL ลบคอมเมนต์ตามโพสต์
- ตรวจสอบการรายงานผ่าน Firebase Console

## 🛡️ ระบบป้องกัน

### การจำกัดการใช้งาน
```dart
static const int _maxCommentsPerDay = 5; // 5 คอมเมนต์/วัน
static const int _maxCommentLength = 200; // 200 ตัวอักษร
```

### ฟิลเตอร์คำหยาบ
```dart
final badWords = [
  'ห่า', 'เหี้ย', 'สัส', 'ควาย', 'ไอ้สัส', 
  'โง่', 'ปี้', 'แม่ง', 'ฟาค', 'fuck', 'shit'
];
// แปลงเป็น *** อัตโนมัติ
```

### การรายงาน
- ผู้ใช้กด "รายงาน" → เพิ่ม reportCount
- Admin ตรวจสอบใน Firebase Console
- คอมเมนต์ที่ถูกรายงานมากจะถูกตรวจสอบ

## 🎨 UI Design

### Bottom Sheet Layout
```
┌─────────────────────────────┐
│ 💬 ความคิดเห็น          ✕ │ ← Header
├─────────────────────────────┤
│ 📝 รายการคอมเมนต์           │ ← Comments List
│   ┌─────────────────────┐   │
│   │ "เจอแล้วหรือยัง?"     │   │
│   │ ผู้ใช้ไม่ระบุชื่อ • 2ชม. │ 🚨  │
│   └─────────────────────┘   │
├─────────────────────────────┤
│ ⚠️ จำกัด 5 ความคิดเห็น/วัน    │ ← Limits Info
│ [พิมพ์ความคิดเห็น...] [📤] │ ← Input
│ 15/200                     │ ← Character Counter
└─────────────────────────────┘
```

### การแสดงในรายการ
- เฉพาะโพสต์ประเภท **"สัตว์หาย"** เท่านั้น
- ปุ่มสีส้มใต้ ListTile
- ไอคอน chat_bubble_outline

## ⚡ Performance & Costs

### Firestore Operations
```
การใช้งานต่อเดือน (สมมติ 100 users):
- Comments: 100 users × 5 comments/day × 30 days = 15,000 writes
- Reads: 15,000 comments × 2 views = 30,000 reads
- Total: 45,000 operations (อยู่ในขีดจำกัดฟรี 50k)
```

### Storage
```
ข้อมูลต่อ comment ≈ 300 bytes
15,000 comments × 300 bytes = 4.5 MB (อยู่ในขีดจำกัดฟรี 1GB)
```

## 🔧 Configuration

### เปิด/ปิดคอมเมนต์ตามประเภท
```dart
// ใน list_screen.dart
if (category == EventCategory.animalLost) {
  // แสดงปุ่มคอมเมนต์
}

// สามารถเพิ่มประเภทอื่น
if (category == EventCategory.animalLost || 
    category == EventCategory.checkpoint) {
  // แสดงปุ่มคอมเมนต์
}
```

### ปรับแต่งขีดจำกัด
```dart
// ใน comment_service.dart
static const int _maxCommentsPerDay = 3; // ลดเป็น 3/วัน
static const int _maxCommentLength = 150; // ลดเป็น 150 ตัวอักษร
```

## 🧪 การทดสอบ

### Test Cases
1. **การคอมเมนต์**
   - คอมเมนต์ครั้งที่ 1-5: สำเร็จ
   - คอมเมนต์ครั้งที่ 6: แสดงข้อผิดพลาด "เกินขีดจำกัด"

2. **ฟิลเตอร์คำหยาบ**
   - พิมพ์ "ห่า" → แสดง "***"
   - พิมพ์ "fuck" → แสดง "****"

3. **การรายงาน**
   - กดรายงาน → แสดง dialog ยืนยัน
   - ยืนยัน → เพิ่ม reportCount ใน Firestore

4. **TTL**
   - คอมเมนต์หมดอายุตามโพสต์ (7 วัน)

## 🚀 การใช้งานจริง

### ขั้นตอนการเปิดใช้
1. **ตั้งค่า TTL ใน Firebase Console**
   ```
   Collection: reports/{reportId}/comments
   TTL Field: expireAt
   ```

2. **ทดสอบ**
   - สร้างโพสต์ประเภท "สัตว์หาย"
   - กดปุ่ม "แสดงความคิดเห็น"
   - พิมพ์คอมเมนต์ทดสอบ

3. **Monitor**
   - ดู Firebase Console → Firestore → comments
   - ตรวจสอบ reportCount ของคอมเมนต์ที่ถูกรายงาน

## 💡 การพัฒนาต่อ

### ฟีเจอร์เพิ่มเติม
1. **การแจ้งเตือน**
   - แจ้งเตือนเมื่อมีคอมเมนต์ใหม่
   - ใช้ Firebase Cloud Messaging (FCM)

2. **ระบบ User**
   - Login เพื่อแสดงชื่อจริง
   - Avatar รูปโปรไฟล์

3. **ฟีเจอร์เพิ่มเติม**
   - แชร์รูปในคอมเมนต์
   - การตอบกลับ (Reply)
   - ปักหมุดคอมเมนต์สำคัญ

### การปรับปรุง UX
1. **การแจ้งเตือนแบบ Real-time**
2. **ระบบ Badge แสดงจำนวนคอมเมนต์**
3. **ฟิลเตอร์คำหยาบที่ชาญฉลาดขึ้น**

---

## 🎉 สรุป

ฟีเจอร์คอมเมนต์ช่วยเพิ่มการสื่อสารในการหาสัตว์เลี้ยงที่หายไป โดย:

✅ **ใช้งานง่าย**: Bottom Sheet UI คุ้นเคย  
✅ **ปลอดภัย**: มีระบบป้องกันสแปมและคำหยาบ  
✅ **ประหยัด**: อยู่ในขีดจำกัดฟรีของ Firebase  
✅ **มีประสิทธิภาพ**: TTL ลบข้อมูลอัตโนมัติ  

**พร้อมใช้งานได้เลย!** 🚀

# ЁЯФз р╣Бр╕Бр╣Йр╕Ыр╕▒р╕Нр╕лр╕▓ Multi-User Camera Reporting

## ЁЯЪи р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ъ

**р╕нр╕▓р╕Бр╕▓р╕г**: 
- Account р╕Чр╕╡р╣Ир╣Вр╕Юр╕кр╕гр╕▓р╕вр╕Зр╕▓р╕Щ тЖТ р╣Ар╕лр╣Зр╕Щр╕Хр╕▒р╕зр╣Ар╕ер╕Вр╕зр╣Ир╕▓р╕бр╕╡р╣Вр╕Юр╕к тЬЕ
- Account р╕нр╕╖р╣Ир╕Щр╕Чр╕╡р╣Ир╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ тЖТ р╕бр╕нр╕Зр╣Др╕бр╣Ир╣Ар╕лр╣Зр╕Щр╕нр╕░р╣Др╕гр╣Ар╕ер╕в тЭМ
- Tab "р╣Вр╕лр╕зр╕Х" р╕зр╣Ир╕▓р╕Зр╣Ар╕Ыр╕ер╣Ир╕▓р╣Бр╕бр╣Йр╕Ир╕░р╕бр╕╡р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Гр╕Щр╕гр╕░р╕Ър╕Ъ

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕р╕лр╕ер╕▒р╕Б**:
1. **Firebase Security Rules** - р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╣Гр╕лр╣Йр╕нр╣Ир╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е cross-user
2. **Google Sign-In Configuration** - р╕нр╕▓р╕Ир╕Хр╣Йр╕нр╕Зр╣Ар╕Юр╕┤р╣Ир╕б test users

---

## тЬЕ р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Чр╕╡р╣Ир╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г

### ЁЯФз **1. р╣Бр╕Бр╣Йр╣Др╕В Firebase Security Rules**

**р╕Ыр╕▒р╕Нр╕лр╕▓р╣Ар╕Фр╕┤р╕б**: `camera_votes` р╕нр╣Ир╕▓р╕Щр╣Др╕Фр╣Йр╣Ар╕Йр╕Юр╕▓р╕░р╕Вр╕нр╕Зр╕Хр╕▒р╕зр╣Ар╕нр╕З
```javascript
// р╣Ар╕Фр╕┤р╕б - р╕Ьр╕┤р╕Ф
allow read: if request.auth != null && request.auth.uid == resource.data.userId;
```

**р╣Бр╕Бр╣Йр╣Др╕Вр╣Ар╕Ыр╣Зр╕Щ**: р╕Чр╕╕р╕Бр╕Др╕Щр╕Чр╕╡р╣Ир╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕нр╣Ир╕▓р╕Щр╣Др╕Фр╣Й
```javascript
// р╣Гр╕лр╕бр╣И - р╕Цр╕╣р╕Б
allow read: if request.auth != null;
```

**р╣Др╕Яр╕ер╣М**: `firestore.rules`
**р╕Др╕│р╕кр╕▒р╣Ир╕З Deploy**: `firebase deploy --only firestore:rules`
**р╕кр╕Цр╕▓р╕Щр╕░**: тЬЕ Deploy р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з

### ЁЯФз **2. р╣Ар╕Юр╕┤р╣Ир╕б Debug Functions**

**р╣Др╕Яр╕ер╣М**: `lib/modules/speed_camera/services/camera_report_service.dart`

**р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Гр╕лр╕бр╣И**:
- тЬЕ `debugMultiUserTest()` - р╕Чр╕Фр╕кр╕нр╕Ъ Multi-User functionality
- тЬЕ Enhanced `getUserVotedReports()` - debug р╣Бр╕Ър╕Ър╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф
- тЬЕ Improved error handling

### ЁЯФз **3. р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З Quick Test App**

**р╣Др╕Яр╕ер╣М**: `lib/quick_test.dart`

**р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╣Гр╕лр╕бр╣И**:
- тЬЕ р╣Бр╕кр╕Фр╕З Email р╕Вр╕нр╕З user р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ
- тЬЕ р╕Ыр╕╕р╣Ир╕бр╕ер╣Зр╕нр╕Бр╣Ар╕нр╕▓р╕Хр╣М
- тЬЕ р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Чр╕Фр╕кр╕нр╕Ъ Multi-User
- тЬЕ Multi-User testing workflow

---

## ЁЯзк р╕зр╕┤р╕Шр╕╡р╕Чр╕Фр╕кр╕нр╕Ъ Multi-User

### **Step 1: Account A (р╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е)**
```bash
flutter run lib/quick_test.dart
```

1. р╕Бр╕Ф "р╕Чр╕Фр╕кр╕нр╕Ър╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ" (р╣Гр╕Кр╣Й Account A)
2. р╕Бр╕Ф "р╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З"
3. р╕Бр╕Ф "р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е" тЖТ р╕Фр╕╣ Debug Console
4. р╕Бр╕Ф "р╕ер╣Зр╕нр╕Бр╣Ар╕нр╕▓р╕Хр╣М"

**р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З**:
```
ЁЯУК Total reports in database: 3
ЁЯСд Current user: user_A_uid
ЁЯУз Current email: user_a@gmail.com
тП│ Pending reports visible to this user: 0
ЁЯСе Pending reports from other users: 0
```

### **Step 2: Account B (р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Вр╕лр╕зр╕Х)**
1. р╕Бр╕Ф "р╕Чр╕Фр╕кр╕нр╕Ър╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ" (р╣Гр╕Кр╣Й Account B - р╕нр╕╡р╣Ар╕бр╕ер╣Мр╕нр╕╖р╣Ир╕Щ)
2. р╕Бр╕Ф "р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е" тЖТ р╕Фр╕╣ Debug Console

**р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З**:
```
ЁЯУК Total reports in database: 3
ЁЯСд Current user: user_B_uid
ЁЯУз Current email: user_b@gmail.com
тП│ Pending reports visible to this user: 3
ЁЯСе Pending reports from other users: 3
тЬЕ SUCCESS: Can see reports from other users
   ЁЯУД Report xxx by user_A_uid on р╕Цр╕Щр╕Щр╕кр╕╕р╕Вр╕╕р╕бр╕зр╕┤р╕Ч
   ЁЯУД Report yyy by user_A_uid on р╕Цр╕Щр╕Щр╕Юр╕лр╕ер╣Вр╕вр╕Шр╕┤р╕Щ
   ЁЯУД Report zzz by user_A_uid on р╕Цр╕Щр╕Щр╕кр╕╡р╕ер╕б
```

### **Step 3: р╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕Щр╣Бр╕нр╕Ыр╕лр╕ер╕▒р╕Б**
```bash
flutter run
```

1. р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕Фр╣Йр╕зр╕в Account B
2. р╣Др╕Ыр╕лр╕Щр╣Йр╕▓ "р╕гр╕▓р╕вр╕Зр╕▓р╕Щ" тЖТ Tab "р╣Вр╕лр╕зр╕Х"
3. р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕гр╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ 3 р╕гр╕▓р╕вр╕Бр╕▓р╕г

---

## ЁЯУК р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕В

### **тЬЕ р╕кр╕Цр╕▓р╕Щр╕░р╕лр╕ер╕▒р╕Зр╣Бр╕Бр╣Йр╣Др╕В**

| р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣М | Account A (р╕Ьр╕╣р╣Йр╣Вр╕Юр╕к) | Account B (р╕Ьр╕╣р╣Йр╣Вр╕лр╕зр╕Х) |
|---------|-------------------|-------------------|
| р╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Хр╕▒р╕зр╣Ар╕нр╕З | тЬЕ р╣Гр╕Кр╣И | тЭМ р╣Др╕бр╣И (р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З) |
| р╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Др╕Щр╕нр╕╖р╣Ир╕Щ | тЭМ р╣Др╕бр╣И (р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З) | тЬЕ р╣Гр╕Кр╣И |
| р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Вр╕лр╕зр╕Хр╣Др╕Фр╣Й | тЭМ р╣Др╕бр╣И (р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З) | тЬЕ р╣Гр╕Кр╣И |
| Tab р╣Вр╕лр╕зр╕Хр╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е | тЭМ р╣Др╕бр╣И (р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З) | тЬЕ р╣Гр╕Кр╣И |

### **ЁЯФН Debug Console Output**

**Account A (р╕Ьр╕╣р╣Йр╣Вр╕Юр╕к)**:
```
ЁЯСе Pending reports from other users: 0
тЬЕ Correctly filtered out own reports
```

**Account B (р╕Ьр╕╣р╣Йр╣Вр╕лр╕зр╕Х)**:
```
ЁЯСе Pending reports from other users: 3
тЬЕ SUCCESS: Can see reports from other users
```

---

## тЪая╕П р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б

### **1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Firebase Console**
- р╣Др╕Ыр╕Чр╕╡р╣И: https://console.firebase.google.com/project/checkdarn-app
- Firestore Database тЖТ Collections тЖТ `camera_reports`
- р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ documents р╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╕Вр╕╢р╣Йр╕Щ

### **2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Authentication**
- Firebase Console тЖТ Authentication тЖТ Users
- р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ users р╕лр╕ер╕▓р╕вр╕Др╕Щ

### **3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Security Rules**
- Firebase Console тЖТ Firestore Database тЖТ Rules
- р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ rules р╕Чр╕╡р╣Ир╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╣Бр╕ер╣Йр╕з

---

## ЁЯОп Next Steps

### **р╕Цр╣Йр╕▓р╣Бр╕Бр╣Йр╣Др╕Вр╣Бр╕ер╣Йр╕з**:
1. тЬЕ р╕гр╕░р╕Ър╕Ъ Multi-User р╕Чр╕│р╕Зр╕▓р╕Щр╣Др╕Фр╣Й
2. тЬЕ Tab р╣Вр╕лр╕зр╕Хр╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
3. тЬЕ р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Вр╕лр╕зр╕Хр╣Др╕Фр╣Й
4. тЬЕ Auto-verification р╕Чр╕│р╕Зр╕▓р╕Щ

### **р╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓**:
1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Debug Console logs
2. р╕вр╕╖р╕Щр╕вр╕▒р╕Щ Firebase Rules deploy р╕кр╕│р╣Ар╕гр╣Зр╕И
3. р╕ер╕нр╕Зр╕ер╣Йр╕▓р╕З cache: `flutter clean && flutter pub get`
4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ internet connection

---

## ЁЯУЮ Troubleshooting

### **р╕Ыр╕▒р╕Нр╕лр╕▓: р╕вр╕▒р╕Зр╕бр╕нр╕Зр╣Др╕бр╣Ир╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Вр╕лр╕зр╕Х**

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕р╕Чр╕╡р╣Ир╣Ар╕Ыр╣Зр╕Щр╣Др╕Ыр╣Др╕Фр╣Й**:
1. **Firebase Rules р╕вр╕▒р╕Зр╣Др╕бр╣И deploy**: р╕гр╕▒р╕Щ `firebase deploy --only firestore:rules`
2. **Cache р╕Ыр╕▒р╕Нр╕лр╕▓**: р╕гр╕▒р╕Щ `flutter clean && flutter pub get`
3. **р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕гр╕┤р╕З**: р╕гр╕▒р╕Щ Quick Test тЖТ р╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З
4. **р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕Фр╣Йр╕зр╕в account р╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ**: р╣Гр╕Кр╣Йр╕нр╕╡р╣Ар╕бр╕ер╣Мр╕нр╕╖р╣Ир╕Щ

### **р╕Ыр╕▒р╕Нр╕лр╕▓: р╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Бр╕Хр╣Ир╣Вр╕лр╕зр╕Хр╣Др╕бр╣Ир╣Др╕Фр╣Й**

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕р╕Чр╕╡р╣Ир╣Ар╕Ыр╣Зр╕Щр╣Др╕Ыр╣Др╕Фр╣Й**:
1. **р╣Вр╕лр╕зр╕Хр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Хр╕▒р╕зр╣Ар╕нр╕З**: р╣Гр╕Кр╣Й account р╕нр╕╖р╣Ир╕Щ
2. **р╣Вр╕лр╕зр╕Хр╕Лр╣Йр╕│**: р╕гр╕░р╕Ър╕Ър╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Бр╕▓р╕гр╣Вр╕лр╕зр╕Хр╕Лр╣Йр╕│
3. **Network error**: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н

---

## ЁЯОЙ р╕кр╕гр╕╕р╕Ы

тЬЕ **р╕Ыр╕▒р╕Нр╕лр╕▓р╕лр╕ер╕▒р╕Бр╕Др╕╖р╕н Firebase Security Rules**
тЬЕ **р╣Бр╕Бр╣Йр╣Др╕Вр╣Бр╕ер╣Йр╕з**: `camera_votes` р╕нр╣Ир╕▓р╕Щр╣Др╕Фр╣Йр╣Вр╕Фр╕вр╕Чр╕╕р╕Бр╕Др╕Щр╕Чр╕╡р╣Ир╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ
тЬЕ **р╣Ар╕Юр╕┤р╣Ир╕б Debug Tools**: р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Чр╕Фр╕кр╕нр╕Ъ Multi-User
тЬЕ **Deploy р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в**: Rules р╣Гр╕лр╕бр╣Ир╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╣Бр╕ер╣Йр╕з

ЁЯОп **р╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╕гр╕░р╕Ър╕Ър╕Др╕зр╕гр╕Чр╕│р╕Зр╕▓р╕Щ Multi-User р╣Др╕Фр╣Йр╣Бр╕ер╣Йр╕з!**

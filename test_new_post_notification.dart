import 'package:cloud_firestore/cloud_firestore.dart';

/*
 * ЁЯзк р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╣Вр╕Юр╕кр╕Хр╣Мр╣Гр╕лр╕бр╣Ир╕Чр╕╡р╣Ир╕бр╕╡р╕Кр╕╖р╣Ир╕нр╕Др╕Щр╣Вр╕Юр╕к (р╕Ыр╕┤р╕Фр╕Ър╕▓р╕Зр╕кр╣Ир╕зр╕Щ)
 * 
 * р╕зр╕┤р╕Шр╕╡р╣Гр╕Кр╣Й:
 * 1. р╣Ар╕Ыр╕┤р╕Ф Terminal р╣Гр╕Щ VS Code
 * 2. р╕гр╕▒р╕Щ: dart test_new_post_notification.dart
 * 
 * р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Щр╕╡р╣Йр╕Ир╕░:
 * - р╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Юр╕кр╕Хр╣Мр╕Чр╕Фр╕кр╕нр╕Ъ
 * - Trigger р╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Чр╕╡р╣Ир╕бр╕╡р╕Кр╕╖р╣Ир╕нр╕Др╕Щр╣Вр╕Юр╕к (р╕Ыр╕┤р╕Фр╕Ър╕▓р╕Зр╕кр╣Ир╕зр╕Щ)
 * - р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Чр╕╡р╣Ир╕кр╣Ир╕Зр╣Гр╕лр╣Йр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕нр╕╖р╣Ир╕Щ
 */

void main() async {
  print('ЁЯзк р╕Бр╕│р╕ер╕▒р╕Зр╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╣Вр╕Юр╕кр╕Хр╣Мр╣Гр╕лр╕бр╣Ир╕Чр╕╡р╣Ир╕бр╕╡р╕Кр╕╖р╣Ир╕нр╕Др╕Щр╣Вр╕Юр╕к...');

  try {
    final firestore = FirebaseFirestore.instance;

    // р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Вр╕Юр╕кр╕Хр╣Мр╕Чр╕Фр╕кр╕нр╕Ъ
    final testReport = {
      'userId': 'test_user_123', // ID р╕Вр╕нр╕Зр╕Др╕Щр╣Вр╕Юр╕к
      'displayName': 'р╕кр╕бр╕Кр╕▓р╕в р╣Гр╕Ир╕Фр╕╡', // р╕Кр╕╖р╣Ир╕нр╕Др╕Щр╣Вр╕Юр╕к (р╕Ир╕░р╕Цр╕╣р╕Бр╕Ыр╕┤р╕Фр╣Ар╕Ыр╣Зр╕Щ "р╕кр╕бр╕К***")
      'description': 'р╕бр╕╡р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Ир╕▒р╕Ър╕Др╕зр╕▓р╕бр╣Ар╕гр╣Зр╕зр╕Ър╕гр╕┤р╣Ар╕зр╕Ур╕Щр╕╡р╣Й р╕Вр╕нр╣Гр╕лр╣Йр╕Вр╕▒р╕Ър╕Вр╕╡р╣Ир╕нр╕вр╣Ир╕▓р╕Зр╕гр╕░р╕бр╕▒р╕Фр╕гр╕░р╕зр╕▒р╕З',
      'category': 'checkpoint',
      'location': 'р╕Цр╕Щр╕Щр╕Юр╕лр╕ер╣Вр╕вр╕Шр╕┤р╕Щ',
      'district': 'р╕лр╕▓р╕Фр╣Гр╕лр╕Нр╣И',
      'province': 'р╕кр╕Зр╕Вр╕ер╕▓',
      'roadName': 'р╕Цр╕Щр╕Щр╕Юр╕лр╕ер╣Вр╕вр╕Шр╕┤р╕Щ',
      'subDistrict': 'р╕лр╕▓р╕Фр╣Гр╕лр╕Нр╣И',
      'timestamp': FieldValue.serverTimestamp(),
      'latitude': 7.0187,
      'longitude': 100.4713,
      'isVerified': false,
      'likeCount': 0,
      'commentCount': 0,
      'imageUrl': null,
    };

    print('ЁЯУЭ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Вр╕Юр╕кр╕Хр╣Мр╕Чр╕Фр╕кр╕нр╕Ъ:');
    print('   ЁЯСд р╕Кр╕╖р╣Ир╕нр╕Др╕Щр╣Вр╕Юр╕к: ${testReport['displayName']}');
    print('   ЁЯУН р╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И: ${testReport['category']}');
    print(
        '   ЁЯМН р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕З: ${testReport['district']}, ${testReport['province']}');
    print('   ЁЯТм р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф: ${testReport['description']}');
    print('');

    // р╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Юр╕кр╕Хр╣Мр╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕Щ Firestore
    print('ЁЯУд р╕Бр╕│р╕ер╕▒р╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Юр╕кр╕Хр╣Мр╕Чр╕Фр╕кр╕нр╕Ъ...');

    final docRef = await firestore.collection('reports').add(testReport);

    print('тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Юр╕кр╕Хр╣Мр╕Чр╕Фр╕кр╕нр╕Ър╕кр╕│р╣Ар╕гр╣Зр╕И!');
    print('ЁЯУД Document ID: ${docRef.id}');
    print('');

    print('ЁЯФФ р╕Др╕▓р╕Фр╕лр╕зр╕▒р╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ:');
    print('   ЁЯУ▒ Title: ЁЯЪУ р╕Фр╣Ир╕▓р╕Щр╕Хр╕гр╕зр╕И - р╕лр╕▓р╕Фр╣Гр╕лр╕Нр╣И, р╕кр╕Зр╕Вр╕ер╕▓');
    print(
        '   ЁЯТм Body: р╕кр╕бр╕К*** р╕гр╕▓р╕вр╕Зр╕▓р╕Щ: р╕бр╕╡р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Ир╕▒р╕Ър╕Др╕зр╕▓р╕бр╣Ар╕гр╣Зр╕зр╕Ър╕гр╕┤р╣Ар╕зр╕Ур╕Щр╕╡р╣Й р╕Вр╕нр╣Гр╕лр╣Йр╕Вр╕▒р╕Ър╕Вр╕╡р╣Ир╕нр╕вр╣Ир╕▓р╕Зр╕гр╕░р╕бр╕▒р╕Фр╕гр╕░р╕зр╕▒р╕З');
    print('   ЁЯУК р╕кр╣Ир╕Зр╣Гр╕лр╣Й: р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕вр╕Бр╣Ар╕зр╣Йр╕Щр╕Др╕Щр╣Вр╕Юр╕к test_user_123)');
    print('');

    print('ЁЯФН р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕Щ Firebase Console:');
    print('   1. Firebase Console > Functions > Logs');
    print('   2. р╕Фр╕╣ log р╕Вр╕нр╕З sendNewPostNotification');
    print('   3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Чр╕╡р╣Ир╕кр╣Ир╕Зр╕нр╕нр╕Б');
    print('');

    print('ЁЯУ▒ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕Щр╣Бр╕нр╕Ы Flutter:');
    print('   1. р╣Бр╕нр╕Ыр╕Вр╕нр╕Зр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕нр╕╖р╣Ир╕Щ (р╣Др╕бр╣Ир╣Гр╕Кр╣И test_user_123) р╕Др╕зр╕гр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ');
    print('   2. р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Др╕зр╕гр╕бр╕╡р╕Кр╕╖р╣Ир╕н "р╕кр╕бр╕К***" р╣Гр╕Щ body');
    print('   3. р╕Бр╕Фр╕Чр╕╡р╣Ир╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Др╕зр╕гр╣Ар╕Ыр╕┤р╕Фр╣Вр╕Юр╕кр╕Хр╣Мр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕лр╕бр╣И');
    print('');

    // р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣Ир╣Бр╕ер╣Йр╕зр╕ер╕Ър╣Вр╕Юр╕кр╕Хр╣Мр╕Чр╕Фр╕кр╕нр╕Ъ
    print('тП│ р╕гр╕н 30 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡ р╣Бр╕ер╣Йр╕зр╕ер╕Ър╣Вр╕Юр╕кр╕Хр╣Мр╕Чр╕Фр╕кр╕нр╕Ъ...');
    await Future.delayed(Duration(seconds: 30));

    await docRef.delete();
    print('ЁЯЧСя╕П р╕ер╕Ър╣Вр╕Юр╕кр╕Хр╣Мр╕Чр╕Фр╕кр╕нр╕Ър╣Бр╕ер╣Йр╕з');
    print('');

    print('тЬЕ р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ!');
  } catch (error) {
    print('тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ:');
    print('   Error: $error');
    print('');
    print('ЁЯТб р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Йр╣Др╕В:');
    print('   1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н Firebase');
    print('   2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╕Бр╕▓р╕гр╣Ар╕Вр╕╡р╕вр╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щ Firestore');
    print('   3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Functions');
  }
}

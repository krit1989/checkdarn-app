const admin = require('firebase-admin');

// Initialize Firebase Admin (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ init)
if (!admin.apps.length) {
  admin.initializeApp({
    credential: admin.credential.applicationDefault(),
    projectId: 'checkdarn-app'
  });
}

async function testMainNotificationFunction() {
  try {
    console.log('üß™ Testing main notification function by creating a test report...');
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô reports collection
    const testReport = {
      userId: 'test_reporter_123', // ‡πÉ‡∏ä‡πâ userId ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
      category: 'checkpoint',
      description: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà - ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç token validation',
      lat: 13.7563,
      lng: 100.5018,
      location: '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£',
      district: '‡πÄ‡∏Ç‡∏ï‡∏õ‡∏ó‡∏∏‡∏°‡∏ß‡∏±‡∏ô',
      province: '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£',
      subDistrict: '‡πÅ‡∏Ç‡∏ß‡∏á‡∏õ‡∏ó‡∏∏‡∏°‡∏ß‡∏±‡∏ô',
      roadName: '‡∏ñ‡∏ô‡∏ô‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏° 1',
      timestamp: admin.firestore.FieldValue.serverTimestamp(),
      displayName: '‡∏ú‡∏π‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö',
      createdAt: admin.firestore.FieldValue.serverTimestamp()
    };
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏à‡∏∞ trigger ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô sendNewPostNotification)
    const docRef = await admin.firestore().collection('reports').add(testReport);
    
    console.log(`‚úÖ Test report created with ID: ${docRef.id}`);
    console.log('üì± This should trigger the main notification function');
    console.log('üîç Check Firebase Console logs to see the notification results');
    
    // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö
    setTimeout(async () => {
      try {
        await docRef.delete();
        console.log('üóëÔ∏è Test report deleted');
      } catch (error) {
        console.error('‚ùå Error deleting test report:', error);
      }
    }, 10000); // ‡∏•‡∏ö‡∏´‡∏•‡∏±‡∏á 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    
  } catch (error) {
    console.error('‚ùå Error testing main notification function:', error);
  }
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö
testMainNotificationFunction();

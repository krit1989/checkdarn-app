# üîç ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Rate Limiting

## ‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?

### üéØ **‡∏ï‡∏≠‡∏ö: ‡πÉ‡∏ä‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á!** 

‡∏£‡∏∞‡∏ö‡∏ö rate limiting ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

## üõ°Ô∏è ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Spam ‡πÉ‡∏ô Code

### 1. ‡πÉ‡∏ô ReportScreen (frontend):
```dart
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå
final canPost = await FirebaseService.canUserPostToday(userId);
if (!canPost) {
  throw Exception('‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î: ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô');
}
```

### 2. ‡πÉ‡∏ô FirebaseService (backend logic):
```dart
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 3 ‡∏£‡∏∞‡∏î‡∏±‡∏ö
static Future<bool> canUserPostToday(String userId) async {
  // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤ (max 1 post)
  final canPostMinute = await _checkRateLimit(userId, 1, Duration(minutes: 1));
  
  // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤ (max 3 posts) 
  final canPostHour = await _checkRateLimit(userId, 3, Duration(hours: 1));
  
  // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (max 5 posts)
  final canPostDay = await _checkRateLimit(userId, 5, Duration(days: 1));
  
  return canPostMinute && canPostHour && canPostDay;
}
```

### 3. ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Firebase:
```dart
// Query ‡∏à‡∏≤‡∏Å Firestore
final recentPosts = await _firestore
    .collection('reports')
    .where('userId', isEqualTo: userId)           // ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ
    .where('timestamp', isGreaterThan: startTime) // ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    .where('status', isEqualTo: 'active')         // ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
    .get();

// ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î
return recentPosts.docs.length < maxPosts;
```

## üîß Firebase Indexes (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß)

‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ composite index ‡πÉ‡∏ô Firestore:
```json
{
  "fields": [
    {"fieldPath": "userId", "order": "ASCENDING"},
    {"fieldPath": "timestamp", "order": "ASCENDING"}, 
    {"fieldPath": "status", "order": "ASCENDING"}
  ]
}
```

‚úÖ **Index ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô firestore.indexes.json ‡πÅ‡∏•‡πâ‡∏ß**

## üö® ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

### 1. User ID:
- ‡∏ó‡∏∏‡∏Å‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å `userId` ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÇ‡∏û‡∏™‡∏ï‡πå
- ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà

### 2. Timestamp:
- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (1 ‡∏ô‡∏≤‡∏ó‡∏µ, 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á, 1 ‡∏ß‡∏±‡∏ô)

### 3. Status:
- ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà `status = 'active'` ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏ã‡πà‡∏≠‡∏ô

### 4. Category:
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
- ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏°‡∏µ‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô

## üß™ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö

### 1. ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö:
```dart
import 'lib/tools/simple_rate_limit_tester.dart';

// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö rate limiting
await RateLimitTester.testRateLimiting('test-user-123');

// ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
await RateLimitTester.checkUserStats('real-user-id');
```

### 2. ‡∏î‡∏π Logs ‡πÉ‡∏ô Console:
```
üîç Checking 1m limit for user: test-user-123
‚è∞ Time range: 2025-08-16T10:30:00 to 2025-08-16T10:31:00
üìä Found 0 posts in the last 1 minute(s) (limit: 1)
‚úÖ User test-user-123 can post (passed all rate limits)
```

## üö´ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î

### ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:
```
üö´ Rate limit exceeded: Too many posts in the last minute
üö´ Rate limit exceeded: Too many posts in the last hour  
üö´ Rate limit exceeded: Too many posts today
‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î ‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏≤‡∏à‡∏£: ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô
```

### Error Handling:
- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢
- ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ú‡πà‡∏≤‡∏ô
- ‡∏ö‡∏≠‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠

## üéØ ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Spam ‡πÉ‡∏ô Practice

### ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° Spam:

1. **‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1**: ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô
2. **‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2 (‡πÉ‡∏ô 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)**: üö´ ‡∏ö‡∏•‡πá‡∏≠‡∏Ñ "Too many posts in the last minute"
3. **‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2 (‡∏´‡∏•‡∏±‡∏á 1 ‡∏ô‡∏≤‡∏ó‡∏µ)**: ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô  
4. **‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 3-5**: ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ)
5. **‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 6**: üö´ ‡∏ö‡∏•‡πá‡∏≠‡∏Ñ "Too many posts today"

### ‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•:
- ‚è±Ô∏è **1 ‡πÇ‡∏û‡∏™‡∏ï‡πå/‡∏ô‡∏≤‡∏ó‡∏µ** - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô rapid fire
- ‚è∞ **3 ‡πÇ‡∏û‡∏™‡∏ï‡πå/‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á** - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô burst spam  
- üìÖ **5 ‡πÇ‡∏û‡∏™‡∏ï‡πå/‡∏ß‡∏±‡∏ô** - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô daily spam
- üìã **‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà** - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô spam ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó

## üîç ‡∏™‡∏£‡∏∏‡∏õ

**‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô spam ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á 100%** ‡πÇ‡∏î‡∏¢:

‚úÖ **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á**  
‚úÖ **‡∏°‡∏µ Firebase index ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô**  
‚úÖ **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö (‡∏ô‡∏≤‡∏ó‡∏µ/‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ß‡∏±‡∏ô)**  
‚úÖ **‡πÅ‡∏¢‡∏Å‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà**  
‚úÖ **‡πÅ‡∏™‡∏î‡∏á error message ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÑ‡∏î‡πâ**  
‚úÖ **‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö**  

**‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° spam ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!** üõ°Ô∏è

rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // ğŸ  à¸à¸à¸ªà¸³à¸«à¸£à¸±à¸š collection reports 
    match /reports/{reportId} {
      allow read: if true;
      allow write: if request.auth != null;
      
      // ğŸ’¬ Subcollection comments à¸ à¸²à¸¢à¹ƒà¸™ reports à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
      match /comments/{commentId} {
        allow read: if true;
        allow write: if request.auth != null;
      }
    }
    
    // ğŸ“· à¸à¸à¸ªà¸³à¸«à¸£à¸±à¸š camera reports - à¸£à¸°à¸šà¸šà¸£à¸²à¸¢à¸‡à¸²à¸™à¸à¸¥à¹‰à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ (à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¹ƒà¸«à¸¡à¹ˆ)
    match /camera_reports/{reportId} {
      allow read: if true;  // à¹€à¸›à¸´à¸”à¹ƒà¸«à¹‰à¸­à¹ˆà¸²à¸™à¹„à¸”à¹‰à¸—à¸¸à¸à¸„à¸™ (à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸¥à¹‡à¸­à¸à¸­à¸´à¸™)
      allow create: if request.auth != null;
      allow update: if request.auth != null;  // à¹€à¸›à¸´à¸”à¹ƒà¸«à¹‰à¸­à¸±à¸›à¹€à¸”à¸•à¹„à¸”à¹‰à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸¥à¹‡à¸­à¸à¸­à¸´à¸™
      allow delete: if request.auth != null && 
                     request.auth.uid == resource.data.reportedBy &&
                     resource.data.status == 'pending';
    }
    
    // ğŸ—³ï¸ à¸à¸à¸ªà¸³à¸«à¸£à¸±à¸š camera votes - à¹‚à¸«à¸§à¸•à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸¥à¹‰à¸­à¸‡ (à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¹ƒà¸«à¸¡à¹ˆ)
    match /camera_votes/{voteId} {
      allow read: if true;  // à¹€à¸›à¸´à¸”à¹ƒà¸«à¹‰à¸­à¹ˆà¸²à¸™à¹„à¸”à¹‰à¸—à¸¸à¸à¸„à¸™
      allow create: if request.auth != null;  // à¸œà¸¹à¹‰à¸¥à¹‡à¸­à¸à¸­à¸´à¸™à¸ªà¸²à¸¡à¸²à¸£à¸–à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸«à¸§à¸•à¹„à¸”à¹‰
      allow update: if request.auth != null;  // à¹€à¸›à¸´à¸”à¹ƒà¸«à¹‰à¸­à¸±à¸›à¹€à¸”à¸•à¹„à¸”à¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸¥à¹‡à¸­à¸à¸­à¸´à¸™
      allow delete: if request.auth != null;  // à¹€à¸›à¸´à¸”à¹ƒà¸«à¹‰à¸¥à¸šà¹„à¸”à¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸¥à¹‡à¸­à¸à¸­à¸´à¸™
    }
    
    // ğŸ“ˆ à¸à¸à¸ªà¸³à¸«à¸£à¸±à¸š user report stats - à¸ªà¸–à¸´à¸•à¸´à¸à¸²à¸£à¸£à¸²à¸¢à¸‡à¸²à¸™
    match /user_report_stats/{userId} {
      allow read: if request.auth != null;  // à¹ƒà¸«à¹‰à¸­à¹ˆà¸²à¸™à¹„à¸”à¹‰à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
      allow write: if request.auth != null;  // à¹ƒà¸«à¹‰à¹€à¸‚à¸µà¸¢à¸™à¹„à¸”à¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸­à¸±à¸›à¹€à¸”à¸• stats
    }
    
    // ğŸ‘¤ à¸à¸à¸ªà¸³à¸«à¸£à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ - à¹€à¸‰à¸à¸²à¸°à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡
    match /users/{userId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ğŸ“Š à¸à¸à¸ªà¸³à¸«à¸£à¸±à¸šà¸ˆà¸³à¸à¸±à¸”à¸à¸²à¸£à¹‚à¸à¸ªà¸•à¹Œ - à¹€à¸‰à¸à¸²à¸°à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡
    match /userLimits/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ğŸ“ˆ à¸à¸à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸–à¸´à¸•à¸´à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ - à¹€à¸‰à¸à¸²à¸°à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡
    match /user_stats/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ğŸ”‘ FCM Tokens - à¹€à¸‰à¸à¸²à¸°à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡
    match /user_tokens/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ğŸ”” Notification Posts - à¸­à¹ˆà¸²à¸™à¹„à¸”à¹‰à¸—à¸¸à¸à¸„à¸™ à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸”à¹‰à¹€à¸‰à¸à¸²à¸° login
    match /notification_posts/{postId} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update, delete: if false;
    }
    
    // ğŸ“Š Notification Stats - à¸­à¹ˆà¸²à¸™à¹„à¸”à¹‰à¹€à¸‰à¸à¸²à¸° login, à¹€à¸‚à¸µà¸¢à¸™à¹„à¸¡à¹ˆà¹„à¸”à¹‰
    match /notification_stats/{statId} {
      allow read: if request.auth != null;
      allow create, update, delete: if false;
    }
  }
}

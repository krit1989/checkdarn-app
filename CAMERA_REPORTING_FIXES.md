# ЁЯЫая╕П р╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓ Camera Reporting System

## ЁЯФН р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ъ

### 1. **р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╣Др╕Фр╣Йр╣Бр╕Хр╣Ир╕Вр╕╢р╣Йр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б "р╕Ыр╕▒р╕Нр╕лр╕▓р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н"**
- **р╕кр╕▓р╣Ар╕лр╕Хр╕╕**: Google Sign-In р╕бр╕╡ conflict р╕Бр╕▒р╕Ъ PigeonUserDetails
- **р╕нр╕▓р╕Бр╕▓р╕г**: р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕зр╣Бр╕Хр╣Ир╕вр╕▒р╕Зр╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б error

### 2. **р╣Др╕бр╣Ир╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕гр╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ**
- **р╕кр╕▓р╣Ар╕лр╕Хр╕╕**: р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Гр╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е Firebase
- **р╕нр╕▓р╕Бр╕▓р╕г**: Tab "р╣Вр╕лр╕зр╕Х" р╕зр╣Ир╕▓р╕Зр╣Ар╕Ыр╕ер╣Ир╕▓

---

## тЬЕ р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Чр╕╡р╣Ир╕Чр╕│р╣Бр╕ер╣Йр╕з

### ЁЯФз **р╣Бр╕Бр╣Йр╣Др╕В Authentication Service**

**р╣Др╕Яр╕ер╣М**: `lib/services/auth_service.dart`

**р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З**:
1. тЬЕ р╣Бр╕Бр╣Йр╣Др╕В error handling р╕кр╕│р╕лр╕гр╕▒р╕Ъ PigeonUserDetails
2. тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ user state р╕лр╕ер╕▒р╕З error
3. тЬЕ р╣Др╕бр╣Ир╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б error р╕Цр╣Йр╕▓р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з

**р╣Вр╕Др╣Йр╕Фр╕Чр╕╡р╣Ир╣Ар╕Юр╕┤р╣Ир╕б**:
```dart
// р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Ир╕гр╕┤р╕Зр╣Ж р╣Бр╕ер╣Йр╕зр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣И
if (e.toString().contains('PigeonUserDetails')) {
  final currentUser = _auth.currentUser;
  if (currentUser != null) {
    // р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Бр╕кр╕Фр╕З error
    return MockUserCredential(user: currentUser);
  }
}
```

### ЁЯФз **р╣Ар╕Юр╕┤р╣Ир╕б Debug р╕кр╕│р╕лр╕гр╕▒р╕Ъ Camera Report Service**

**р╣Др╕Яр╕ер╣М**: `lib/modules/speed_camera/services/camera_report_service.dart`

**р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З**:
1. тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕г debug р╣Бр╕Ър╕Ър╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф
2. тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е
3. тЬЕ р╣Бр╕кр╕Фр╕Зр╕кр╕▓р╣Ар╕лр╕Хр╕╕р╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г
4. тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З

**р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Гр╕лр╕бр╣И**:
- `createSampleReports()` - р╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З
- `debugAllReports()` - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф

---

## ЁЯЪА р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### **Method 1: р╣Гр╕Кр╣Йр╣Бр╕нр╕Ыр╕Чр╕Фр╕кр╕нр╕Ъ**

1. **р╕гр╕▒р╕Щр╣Бр╕нр╕Ыр╕Чр╕Фр╕кр╕нр╕Ъ**:
```bash
cd /Users/kritchaponprommali/checkdarn
flutter run lib/test_create_sample_data.dart
```

2. **р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╣Гр╕Щр╣Бр╕нр╕Ы**:
   - р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕Фр╣Йр╕зр╕в Google
   - р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕Фр╕кр╕нр╕Ъ"
   - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Фр╣Йр╕зр╕в "р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е"

3. **р╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕Щр╣Бр╕нр╕Ыр╕лр╕ер╕▒р╕Б**:
   - р╣Ар╕Ыр╕┤р╕Фр╣Бр╕нр╕Ы CheckDarn р╕лр╕ер╕▒р╕Б
   - р╣Др╕Ыр╕лр╕Щр╣Йр╕▓ "р╕гр╕▓р╕вр╕Зр╕▓р╕Щ"
   - р╣Ар╕ер╕╖р╕нр╕Б Tab "р╣Вр╕лр╕зр╕Х"
   - р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕гр╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ

### **Method 2: р╣Гр╕Кр╣Й Script**
```bash
./run_test_create_data.sh
```

---

## ЁЯУК р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М

### **р╣Гр╕Щр╣Бр╕нр╕Ыр╕лр╕ер╕▒р╕Б**
1. **Tab "р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Гр╕лр╕бр╣И"**: р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╣Ир╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Й
2. **Tab "р╣Вр╕лр╕зр╕Х"**: р╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕гр╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ (р╣Др╕бр╣Ир╕гр╕зр╕бр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Вр╕нр╕Зр╕Хр╕▒р╕зр╣Ар╕нр╕З)
3. **Tab "р╕кр╕Цр╕┤р╕Хр╕┤"**: р╣Бр╕кр╕Фр╕Зр╕Др╕░р╣Бр╕Щр╕Щр╕Бр╕▓р╕гр╕бр╕╡р╕кр╣Ир╕зр╕Щр╕гр╣Ир╕зр╕б

### **р╣Гр╕Щ Debug Console**
```
ЁЯУК Total reports in database: 3
ЁЯУД Report xxx:
   Status: pending
   Type: newCamera
   Road: р╕Цр╕Щр╕Щр╕кр╕╕р╕Вр╕╕р╕бр╕зр╕┤р╕Ч
   Reporter: user_uid
   Upvotes: 0
   Downvotes: 0
   Confidence: 0.0
```

---

## ЁЯОп р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╣Бр╕Ър╕Ъ Multi-User

### **р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Вр╕лр╕зр╕Х**
1. **User A**: р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щ
2. **User B**: р╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╣Вр╕лр╕зр╕Х (р╕Ир╕░р╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Вр╕нр╕З User A)
3. **User C**: р╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╣Вр╕лр╕зр╕Хр╕Хр╣Ир╕н

### **р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З**
- User A р╣Др╕бр╣Ир╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Вр╕нр╕Зр╕Хр╕▒р╕зр╣Ар╕нр╕З
- User B р╣Бр╕ер╕░ C р╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Вр╕нр╕З User A
- р╣Ар╕бр╕╖р╣Ир╕нр╕Др╕гр╕Ъ 5 р╣Вр╕лр╕зр╕Х + confidence тЙе 80% тЖТ Auto-verify
- р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Чр╕╡р╣И verified р╕Ир╕░р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Вр╣Йр╕▓р╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕лр╕ер╕▒р╕Б

---

## ЁЯФН р╕Бр╕▓р╕г Debug р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б

### **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е**
```dart
await CameraReportService.debugAllReports();
```

### **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Authentication**
```dart
await AuthService.debugAuthStatus();
```

### **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Вр╕лр╕зр╕Х**
```dart
final votedReports = await CameraReportService.getUserVotedReports();
print('User has voted on: $votedReports');
```

---

## тЪая╕П р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕р╕кр╕│р╕Др╕▒р╕Н

1. **Firebase Rules**: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Firestore rules р╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╕Бр╕▓р╕г read/write
2. **Internet Connection**: р╕Хр╣Йр╕нр╕Зр╕бр╕╡р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕нр╕┤р╕Щр╣Ар╕Чр╕нр╕гр╣Мр╣Ар╕Щр╣Зр╕Х
3. **Multiple Accounts**: р╣Гр╕Кр╣Йр╕нр╕╡р╣Ар╕бр╕ер╣Мр╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Вр╕лр╕зр╕Х
4. **Distance Filter**: р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕нр╕▓р╕Ир╕Цр╕╣р╕Бр╕Бр╕гр╕нр╕Зр╕нр╕нр╕Бр╕Цр╣Йр╕▓р╕нр╕вр╕╣р╣Ир╣Др╕Бр╕ер╣Ар╕Бр╕┤р╕Щр╣Др╕Ы

---

## ЁЯОЙ р╕кр╕гр╕╕р╕Ы

тЬЕ **р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Бр╕ер╣Йр╕з**:
- р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б "р╕Ыр╕▒р╕Нр╕лр╕▓р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н" р╕лр╕ер╕▒р╕Зр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И
- р╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕гр╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ (р╣Ар╕Юр╕┤р╣Ир╕бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З)

тЬЕ **р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Й**:
- р╕гр╕░р╕Ър╕Ър╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ Google
- р╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕ер╣Йр╕нр╕Зр╣Гр╕лр╕бр╣И
- р╕Бр╕▓р╕гр╣Вр╕лр╕зр╕Хр╕Ир╕▓р╕Бр╕Кр╕╕р╕бр╕Кр╕Щ
- р╕Бр╕▓р╕г Auto-verify
- р╕Бр╕▓р╕гр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Вр╣Йр╕▓р╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕лр╕ер╕▒р╕Б

ЁЯОп **р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Хр╣Ир╕нр╣Др╕Ы**:
1. р╕гр╕▒р╕Щр╣Бр╕нр╕Ыр╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
2. р╕Чр╕Фр╕кр╕нр╕Ър╕Фр╣Йр╕зр╕в multiple accounts
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ър╣Вр╕лр╕зр╕Х
4. р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕г Auto-verification
